
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
<title>Live Free or Dichotomize - LSTM neural nets as told by baseball</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Live Free or Dichotomize">
<meta name="generator" content="Hugo 0.20.2" />

  



<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">


    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">








<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../../../css/tuftesque.css">
<style>
body {
  
    background-color: #fffff8;
  
}
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92165973-1', 'auto');
  ga('send', 'pageview');
</script>


</head>

<body>
<div id="layout" class="pure-g">
<article class="pure-u-1">
<header class="brand">
  <h1>
    <a href="../../../../">
      <span id = "blog_logo">
         <img src="../../../../images/logo.png" alt="Blog Logo" style="height: 40px; width:40px">
      </span>
      
    </a>
  </h1>
</header>

<section>
  <h1 class="content-title">
  
  <a href="../../../../2017/11/08/lstm-neural-nets-as-told-by-baseball/">LSTM neural nets as told by baseball</a>
  
  </h1>
  
  
  
  <span class="content-meta">
    
  
  
  
  <i class="fa fa-user">&nbsp;</i><span class="author">
    &nbsp;Nick Strayer</span> <br>
    
  
  
  
  <i class="fa fa-calendar"></i>
    &nbsp;Nov 8, 2017
  
  
  
  &nbsp;<i class="fa fa-clock-o"></i>
    &nbsp;7 min read
  
  
  
  <br>
    <i class="fa fa-tags"> </i>
    
    <a  href="../../../../categories/deep-learning">deep learning</a>
    
    <a  href="../../../../categories/algorithms">algorithms</a>
    
    <a  href="../../../../categories/baseball">baseball</a>
    
    
    </span>
    
    
    </section>


<section><p>Currently I am studying for my qualifying exams on which the topic is “using deep neural networks for classification of time series data.” One extremely popular neural net architecture for doing this is the LSTM, or Long Short Term Memory model. The LSTM is a relatively recent advance <label for="tufte-mn-pyhvxfwcmp" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-pyhvxfwcmp" class="margin-toggle"><span class="marginnote">Introduced in <a href="http://www.bioinf.jku.at/publications/older/2604.pdf">1997 by Hochreiter and Schmidhuber</a></span> in the the class of networks known as Recurrent Neural Networks (RNNs).</p>
<p>My main problem when I was learning about LSTMs was the horrifically mathematical way the are first described. <label for="tufte-mn-tjguufnkmu" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-tjguufnkmu" class="margin-toggle"><span class="marginnote"><img src="https://deeplearning4j.org/img/gers_lstm.png" /> The typical way an LSTM is first introduced. This is from <a href="https://deeplearning4j.org/lstm.html">The <em>Beginers</em> Guide to RNNs</a>… Hope you’re an advanced beginner.</span> Almost always the first introduction you get to them is a giant hairball diagram with a bunch of proprietary symbols and shapes accompanied by some equally confusing math equations. Personally, all this does is make me question my decision to go to grad school, not help me understand what’s going on. After struggling through a lot of these introductions however, I have come up with a way that I use to intuitively understand what LSTM networks do using a baseball analogy. Hopefully it helps you too.</p>
<div id="problem-setup" class="section level2">
<h2>Problem Setup</h2>
<p>You and a friend are sitting in your house watching a baseball game. Your friend is a fair-weather baseball fan and really doesn’t care about the game’s details, just who’s winning. They decide that instead of wasting their time watching the game they can make animojis on their phone and just have you dictate the game to them.</p>
<p>In order to do this efficiently you need to devise a strategy that will allow you to give your friend what he needs to know, while keeping track of the game in your own head.</p>
<p><img src="../../../../lstm_explainer/simple_lstm.png" /> <label for="tufte-mn-dsuoeuoybk" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-dsuoeuoybk" class="margin-toggle"><span class="marginnote">How our baseball neural network is setup.</span></p>
</div>
<div id="quick-rnn-background" class="section level2">
<h2>Quick RNN background</h2>
<p>RNNs are neural networks that keep track of what they have seen and use that to aid their classification or regression output for a given element in a sequence. For instance, if you were modeling a sentence, an RNN would see the letters <code>COO</code> and then, because it remembers its context from the previous three letters, will predict <code>L</code> as the next letter. This is contrasted with a naive approach which would not remember the previously seen data and would always predict <code>E</code> because it’s the most common letter in the English language.</p>
<p><label for="tufte-mn-ecinsnfsqh" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-ecinsnfsqh" class="margin-toggle"><span class="marginnote">Fun fact: recently <a href="https://codesachin.wordpress.com/2017/01/18/understanding-the-new-google-translate/">Google switched over their translation system</a> to use LSTMs. Language translation is a particularly good usecase for these types of models as sometimes words in early parts of a sentence matter a lot in later parts, but they don’t always occur the same distance before. Thus having a flexible model that can keep track of what it’s seen helps a great deal in translation.</span></p>
<p>There are many problems with the simple implementations of RNNs that are way too complicated to go into here and not the point of this post. If you want to know more about them I would recommend any combination of <a href="http://www.bioinf.jku.at/publications/older/2604.pdf">original LSTM paper</a>, <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/">this excelent blog post</a> by Chris Olah, and the chapter on RNNs from <a href="http://www.deeplearningbook.org/contents/rnn.html">Goodfellow et al.’s deep learning textbook</a>. All that you need to know is that, the LSTM solved many of the issues associated with training RNNs by using some clever strategies, mainly their ability to remember and forget using “gates.”</p>
<p><img src="../../../../lstm_explainer/hidden_to_hidden.png" /> <em>How our baseball RNN will work.</em></p>
<p>To recap, there are two main facts you need to remember in regards to RNNs (including their subset the LSTM):</p>
<ol style="list-style-type: decimal">
<li>An RNN takes an input and passes that input through a ‘hidden’ layer before returning its output of interest.</li>
<li>The hidden layers can communicate with each other through the sequence. Aka the hidden layer knows the values of itself at the previou time point.</li>
</ol>
</div>
<div id="your-strategy-aka-an-lstm" class="section level2">
<h2>Your strategy (aka an LSTM)</h2>
<div class="fullwidth">
<div class="figure">
<img src="../../../../lstm_explainer/lstm_block.png" />

</div>
</div>
<p><em>Your LSTM strategy for watching the game.</em></p>
<p>You decide to break your strategy for keeping your friend informed into three parts: what you care about, what you don’t care about anymore, and what your friend cares about.</p>
<div id="part-1-what-you-care-about-the-input-gate" class="section level3">
<h3>Part 1: What you care about (the input gate)</h3>
<p>Say a batter is up and he has two strikes. The next pitch comes in and he fouls it to right field. Since you can’t strike out on a foul ball this pitch essentially doesn’t matter to the current status of the game. <label for="tufte-mn-uokfjwxkbl" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-uokfjwxkbl" class="margin-toggle"><span class="marginnote">Sure you could argue that it does in fact matter that the pitcher is more tired and the batter is more weary, but let’s be reasonable</span> In the slot in your brain for keeping track of the batters risk of striking out you simply don’t change anything in response to this new information. What you have done is decided to supress the <em>input</em> of this new information.</p>
</div>
<div id="part-2-what-information-no-longer-matters-the-forget-gate" class="section level3">
<h3>Part 2: What information no longer matters (the forget gate)</h3>
<p>Let’s continue with the current batter with two strikes. Say on the next pitch he hits a great fly to left field and the fielder misses it. He gets all the way to second for a double. <label for="tufte-mn-zerpkcjbwi" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-zerpkcjbwi" class="margin-toggle"><span class="marginnote"><img src="https://4.imimg.com/data4/UV/JX/MY-14300680/home-gate-500x500.jpg" /> Of no importance, I just thought this was a nice looking gate. <a href="https://4.imimg.com/data4/UV/JX/MY-14300680/home-gate-500x500.jpg">Source</a></span> The previous knowledge that you were carrying with you, the fact that the count was two strikes, no longer is important to the game. Once a batter has gotten on base, even though he had two strikes before he got there that information no longer makes any difference to the game’s outcome. Because of this you decide you can <em>forget</em> this information because you will no longer need it.</p>
</div>
<div id="part-3-what-you-tell-your-friend-the-output-gate" class="section level3">
<h3>Part 3: What you tell your friend (the output gate)</h3>
<p>Let’s stay with the play we considered for part 2. In this case the batter has made it to a base, and thus the state of the game has changed. For instance if a home run is hit now, there would be two runs instead of just one. Due to this, you have chosen to remember the fact that there is a runner on second base. <label for="tufte-mn-xgbwfkautp" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-xgbwfkautp" class="margin-toggle"><span class="marginnote"><img src="https://headguruteacher.files.wordpress.com/2013/02/screen-shot-2013-02-12-at-22-26-37.png" /> <a href="https://headguruteacher.files.wordpress.com/2013/02/screen-shot-2013-02-12-at-22-26-37.png">Source</a></span>However, since your friend doesn’t care about anything but the score of the game, he would gain nothing from you telling him this information, so you simply omit it in your report of the play. So, while you still know it’s important to the potential future score of the game, at this time it has not changed anything so you supress your <em>output</em> to your friend.</p>
</div>
</div>
<div id="recap" class="section level2">
<h2>Recap</h2>
<p>Using these simple steps to simultaneously keep track of the information that may be important for the future plays, while at the same time keeping your friend updated for the current play, you have essentially become the hidden layer in an LSTM RNN.</p>
<p>There are plenty of other nitty gritty details about what exactly goes on in an LSTM but what is the most important about how they work is their ‘gates.’ These gates help them efficiently keep track of dependencies in the outcome that are influenced by input events happening at flexible amounts of time before. Traditional RNNs simply take their previous knowledge and transfer it wholesale to themselves at the next time-point, which, as illustrated in part two, can be very wasteful, and hard to optimize.</p>
<p><label for="tufte-mn-avflxsuzis" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-tufte-mn-avflxsuzis" class="margin-toggle"><span class="marginnote"><img src="http://deeplearning.net/tutorial/_images/lstm_memorycell.png" /> By far the easiest to parse technical diagram of the LSTM I’ve found. <a href="http://deeplearning.net/tutorial/_images/lstm_memorycell.png">Source</a></span></p>
<p>RNNs in general are fantastically powerful algorithms because of their flexibility to learn the patterns in time that are important. This contrasts with old school methods like sliding windows, where the model is only capable of looking backwards a set amount of time, which is bad if an event of interest is further back than that window, or if most of data contained in the window is not neccesary for the current situation.</p>
<p>I admit though that I wrote this article from the entirely unrealistic perspective of a person who has been reading literature on this for a good bit now, so it is very likely I glossed over some points that are critical to your grasp of the problem. If this happened, please don’t hesitate to send me angry messages on <a href="twitter.com/NicholasStrayer">twitter</a> or leave a comment below.</p>
</div>
</section>
<section>
  

  
    
    
    
    
    
    
    
    

    
    <hr/>
    <div class="author_blurb">
        <div class="author_photo">
          <div class="photo">
            <img style = "border-radius: 25px;" src="https://avatars0.githubusercontent.com/u/6764693?v=3&amp;u=c9c491a636605fe3d6122defb43eb367b3d9381f&amp;s=400" alt="Nick Strayer image" width="90" height="90">
          </div>
        </div>
        <div class = "author_info">
          <div class = "contact_info">
              <span class = "name"> 
                Nick Strayer 
              </span>
              
              <span class = "social_links">
                 
                  <a class = "social_buttons" href = http://nickstrayer.me >
                      <img style="width:20px;" src = "http://image.flaticon.com/icons/png/128/12/12195.png"/>
                  </a>
                
                
                  <a class="social_buttons" href = https://twitter.com/NicholasStrayer>
                    <img style="width:22px;" src = "https://cdn1.iconfinder.com/data/icons/logotypes/32/twitter-128.png"/>
                  </a>
                
                
                  <a class = "social_buttons" href = https://github.com/nstrayer >
                    <img style="width:23px;" src = "https://a248.e.akamai.net/assets.github.com/images/icons/emoji/octocat.png"/>
                  </a>
                
              </span>  
              
          </div>
          <div class = "bio">
            <p class = "bio_text">Randomly walking my way though a career in statistics</p>
          </div>
        </div>
      </div>
    
  
  



  


  <div id="disqus_thread"></div>
    <script type="text/javascript">
       
      var disqus_shortname = 'livefreeordichotomize'; 
      var disqus_identifier = '\/2017\/11\/08\/lstm-neural-nets-as-told-by-baseball\/';
       
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      
  <footer class="page-footer">
		<hr>
		<ul class="page-footer-menu">
		
		</ul>

  

	<div class="copyright">
	<p>
    
      &copy;2017
    .
    All rights reserved.
    
  </p>
</div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    });
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</footer>

</section>
</article>
</div>
</body>
</html>
